language: node_js
node_js:
  - 12

jobs:
  include:
    - stage: tests and code coverage
      script: yarn run test & sed -i "s/\.\.\/\.\.\///g" coverage/lcov.info && ./node_modules/coveralls/bin/coveralls.js < coverage/lcov.info

deploy:
  # Deploys package on NPM
  - provider: script
    script: sed -i "s/TRAVIS_TAG/$TRAVIS_TAG/g" package.json && yarn run build && npm publish ./dist
    on:
      tags: true
  # Generates documentation
  - provider: pages
    cleanup: false
    keep_history: true
    github_token: $GITHUB_TOKEN
    on:
      branch: master
before_deploy:
  - yarn run doc
  - touch doc/.nojekyll
